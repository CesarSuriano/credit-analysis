<p-card class="w-full">
  <app-card-label label="Documentos" />
  <p-accordion>
    <p-accordionTab *ngFor="let document of documents" [header]="document.name + ' - ' + document.document">
      <h2 class="font-poppins-bold text-lg mb-5">Análise</h2>
      <p-table [value]="document.analysis" dataKey="name" [tableStyle]="{'min-width': '60rem'}">
        <ng-template pTemplate="header">
          <tr>
            <th>Id</th>
            <th>Descrição</th>
            <th>Resultado</th>
            <th>Regras</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-analysis let-expanded="expanded">
          <tr>
            <td>{{analysis.id}}</td>
            <td>{{analysis.name}}</td>
            <td><span [class]="results[analysis.result].class"
                class="py-2 px-4 rounded-md">{{results[analysis.result].label}}</span></td>
            <td><button pButton type="button" icon="pi pi-external-link"
                class="p-button-raised p-button-rounded bg-primaryGreen hover:!bg-darkGreen border-none"
                (click)="showRules = true; currentRule = analysis.rules"></button></td>
          </tr>
        </ng-template>
      </p-table>
    </p-accordionTab>
  </p-accordion>
</p-card>


<p-dialog header="Regras" [(visible)]="showRules" [breakpoints]="{'960px': '75vw', '640px': '100vw'}"
  [style]="{width: '50vw'}">
  <p-accordion>
    <p-accordionTab [header]="'Bloqueadas'">
      <div *ngIf="currentRule && currentRule.blocked && currentRule.blocked.length > 0">
        <p-card class="w-full" *ngFor="let block of currentRule.blocked">
          <app-card-label label="Detalhes do bloqueio" />
          <div class="flex-col">
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Nome</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{block.name}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Descrição</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{block.description}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Status</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{status[block.status].label}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Data de execução</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{formatDate(block.executedAt)}}</h4>
          </div>
          <app-card-label label="Variáveis" class="mt-10 mb-4" />
          <p-table [value]="block.variables" dataKey="name" [tableStyle]="{'min-width': '60rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Atributo</th>
                <th>Descrição</th>
                <th>Valor</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-variable let-expanded="expanded">
              <tr>
                <td>{{variable.attribute}}</td>
                <td>{{variable.name}}</td>
                <td>{{variable.value}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </p-accordionTab>

    <p-accordionTab [header]="'Alertas'">
      <div *ngIf="currentRule && currentRule.alerts && currentRule.alerts.length > 0">
        <p-card class="w-full" *ngFor="let alert of currentRule.alerts">
          <app-card-label label="Detalhes do alerta" />
          <div class="flex-col">
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Nome</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{alert.name}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Descrição</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{alert.description}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Status</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{status[alert.status].label}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Data de execução</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{formatDate(alert.executedAt)}}</h4>
          </div>
          <app-card-label label="Variáveis" class="mt-10 mb-4" />
          <p-table [value]="alert.variables" dataKey="name" [tableStyle]="{'min-width': '60rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Atributo</th>
                <th>Descrição</th>
                <th>Valor</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-variable let-expanded="expanded">
              <tr>
                <td>{{variable.attribute}}</td>
                <td>{{variable.name}}</td>
                <td>{{variable.value}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </p-accordionTab>

    <p-accordionTab [header]="'Aprovadas'">
      <div *ngIf="currentRule && currentRule.proceed && currentRule.proceed.length > 0">
        <p-card class="w-full" *ngFor="let proceed of currentRule.proceed">
          <app-card-label label="Detalhes da aprovação" />
          <div class="flex-col">
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Nome</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{proceed.name}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Descrição</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{proceed.description}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Status</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{status[proceed.status].label}}</h4>
            <h3 class="text-base font-poppins-regular text-gray-600 mb-2">Data de execução</h3>
            <h4 class="text-base font-poppins-semibold mb-6">{{formatDate(proceed.executedAt)}}</h4>
          </div>
          <app-card-label label="Variáveis" class="mt-10 mb-4" />
          <p-table [value]="proceed.variables" dataKey="name" [tableStyle]="{'min-width': '60rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Atributo</th>
                <th>Descrição</th>
                <th>Valor</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-variable let-expanded="expanded">
              <tr>
                <td>{{variable.attribute}}</td>
                <td>{{variable.name}}</td>
                <td>{{variable.value}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </p-accordionTab>
  </p-accordion>
  <ng-template pTemplate="footer">
    <p-button icon="pi pi-check" (click)="showRules=false" label="Ok" styleClass="p-button-text"></p-button>
  </ng-template>
</p-dialog>